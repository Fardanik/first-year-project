<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Room Scout</title>
  <link rel="icon" href="{{ url_for('static',filename='images/logo-svg.svg') }}">
  <link rel="stylesheet" href="{{ url_for('static',filename='style/style.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static',filename='font-awesome-4.7.0/css/font-awesome.min.css') }}" />
  <style>
    .account-dropdown {
      position: relative;
      display: inline-block;
    }
    
    .dropdown-content {
      display: none;
      position: absolute;
      background-color: #f9f9f9;
      min-width: 160px;
      box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
      z-index: 100;
      right: 0;
      top: 100%;
      border-radius: 4px;
      margin-top: 5px;
    }
    
    .dropdown-content a {
      color: black;
      padding: 12px 16px;
      text-decoration: none;
      display: block;
      text-align: left;
    }
    
    .dropdown-content a:hover {
      background-color: #f1f1f1;
    }
    
    .account-dropdown:hover .dropdown-content {
      display: block;
    }
  </style>
</head>

<body>
  <div class="wrapper">
    <div class="menu">
      <a href="#" class="menu-btn">
        <div class="menu-buts">
          <i class="fa fa-navicon" aria-hidden="true"></i>
        </div>
      </a>
      <nav class="menu-list">
        <a href="{{ url_for('main.home') }}">Home</a>
        <a href="{{ url_for('main.property_list') }}">Match</a>
        <a href="{{ url_for('main.messages') }}">Messages</a>
        <a href="{{ url_for('main.shortlist') }}">My shortlist</a>
        <a href="{{ url_for('main.login') }}" id="mobile-account-link">Log in</a>
      </nav>
    </div>
    <div class="content">
      <nav class="navbar">
        <div class="logo">
            <a href="{{ url_for('main.home') }}"><img src="{{ url_for('static',filename='images/Logo.png') }}" alt="Room Scout Logo"></a>
        </div>
        <div class="nav-links">
          <a href="{{ url_for('main.home') }}">Home</a>
          <a href="{{ url_for('main.property_list') }}">Match</a>
          <a href="{{ url_for('main.messages') }}">Messages</a>
          <a href="{{ url_for('main.shortlist') }}">My shortlist</a>
          <a href="{{ url_for('main.login') }}" id="account-link">Log in</a>
        </div>
    </nav>
      <section class="search" style="margin-top: 0px">
        <div class="container">
          <div class="search-inner">
            <h1 style="font-size: 50px;"><b>We scout, you settle!</b></h1>
            <!-- <div class="search-map" style="padding:0px; border: 0">
                <script src="https://cdn.apple-mapkit.com/mk/5.x.x/mapkit.js"></script>
                <style>
                  #map {
                      width: 100%;
                      height: 600px;
                  }
              </style>
              <div id="map"></div>

              <script>
                  // Initialize MapKit with your token
                  mapkit.init({
                      authorizationCallback: function(done) {
                          done(""); // Replace with your actual token
                      }
                  });
          
                  // Create a map instance
                  const map = new mapkit.Map("map");
          
                  // Set the center coordinates (latitude, longitude)
                  var centerCoordinate = new mapkit.Coordinate(53.465930954133505, -2.2321314982809373); // UOM, MCR
                  var centerSpan = new mapkit.CoordinateSpan(0.032,0.032);
                  var region = new mapkit.CoordinateRegion(centerCoordinate,centerSpan);
                  map.setRegionAnimated(region);
                  // Center the map on the given coordinate
                  //"map.setCenterAnimated(centerCoordinate);"
                  
                  //Function to  on map for a set of lat/long coords
                  function addPin(map, latitude, longitude, title, color = "red", id) {
                    if (!mapkit || !map) {
                        console.error("MapKit JS is not initialized or map is missing.");
                        return;
                    }

                    let coordinate = new mapkit.Coordinate(latitude, longitude);

                    let annotation = new mapkit.MarkerAnnotation(coordinate, {
                        title: title,
                        color: color, // Can be "red", "blue", "green", etc.
                        subtitle: "Click the marker for more property information",
                        calloutEnabled: true,
                        glyphImage: {  // Custom icon instead of text
                          1: "{{ url_for('static',filename='images/logo.png') }}" // Replace with your actual image URL
                        }
                    });
                    

                    // Add an event listener for marker selection
                    map.addEventListener("select", (event) => {
                        if (event.annotation === annotation) {
                          if (id) {
                            let baseUrl = "{{ url_for('main.property_info', id=0) }}".replace("0", "");
                            function getPropertyUrl(id) {
                                return `${baseUrl}${id}`;
                            }
                            
                            let custom_url = getPropertyUrl(id);
                            console.log(custom_url);
                            window.open(custom_url);
                          } else {
                            window.open("{{ url_for('main.property_info',id=0)}}", "_blank");
                          }
                        }
                    });

                    map.addAnnotations([annotation]);
                  }
                  
                  let postcodeList = ['M14 5PG', 'M14 5PT', 'M14 5QL', 'BL1 2PG', 'M14 6TB', 'M14 6YH', 'M14 6QX', 'M14 6TZ', 'M6 7DG', 'M15 5QL', 'M15 5LL'];
                  
                  // Check house wether exits
                  try {
                    let houses = JSON.parse('{{ houses | tojson | safe }}');
                    let idListDB = [];
                    let postcodeListDB = [];
                    
                    houses.forEach(house => {
                      postcodeListDB.push(house["postal_code"]);
                      idListDB.push(house["id"]);
                    });
                    
                    

                    for (let i=0; i<postcodeListDB.length; i++){
                      getCoordinates(postcodeListDB[i])
                      .then(([latitude,longitude]) => { 
                        addPin(map, latitude, longitude, title="", color="#efda51", id=idListDB[i])
                      })
                      .catch(error => {
                        console.error("Error getting coordinates", error);        
                      });
                    }
                  } catch (e) {
                    console.log("Houses data not available, using fallback postcodes");
                    //Using default postcode list
                    colorList = ["red","orange","yellow","green","blue","indigo","violet"];
                    
                    for (let i=0; i<postcodeList.length; i++){
                      getCoordinates(postcodeList[i])
                      .then(([latitude,longitude]) => { 
                        addPin(map, latitude, longitude, title="", color="#efda51")
                      })
                      .catch(error => {
                        console.error("Error getting coordinates", error);        
                      });
                    }
                  }
                  
                  //Function to get coordinates
                  function getCoordinates(address) {
                    return new Promise((resolve, reject) => {
                      if (!mapkit || !mapkit.Search) {
                          return reject("MapKit JS is not initialized.");
                      }

                      const geocoder = new mapkit.Geocoder();
                      
                      geocoder.lookup(address, function(error, data) {
                          if (error) {
                              console.error("Geocoding error:", error);
                              return reject(error);
                          }

                           // If successful, extract the coordinates from the response
                          if (data.results.length > 0) { 
                              var coordinate = data.results[0].coordinate;
                              var lat = coordinate.latitude;
                              var long = coordinate.longitude;
                              
                              return resolve([lat,long]);
                            }
                          else {
                            return reject("No results found");
                          }}
                      );
                  });
              }
              
              getCoordinates("Snowdon summit")
              .then(([latitude,longitude]) => { addPin(map,latitude,longitude,title="Snowdon Summit",color="red")
              })
              .catch(error => {console.error("Error getting coordinates",error);
              });
              </script>
          </div> -->
          <div class="search-map"><iframe
                src="https://yandex.com/map-widget/v1/?um=constructor%3Ac2bbe444f1bbc519add2a5ab7e3d79e9bc9ef0636e92523c1003295672d7d44f&amp;source=constructor"
                width="83%" height="400" frameborder="0"></iframe></div>
        </div>
      </section>
      
      <section class="service" style="margin-bottom:5px">
        <div class="container">
          <div class="service-inner">
            <div class="service-title" style="margin: 0; margin-bottom: -30px; margin-top: -20px">
              <h2><b>Our service</b></h2>
            </div>
            <div class="service-container">
              <div class="service-item">
                <img src="{{ url_for('static',filename='images/searchimager.jpg') }}" alt="Search" class="cards"/>
                <h3>Search</h3>
                <p>
                  Search for the best property for you, using RoomScout's precise search criteria. Filter by property type, maximum budget, number of housemates and more.
                </p>
              </div>
              <div class="service-item">
                <img src="{{ url_for('static',filename='images/cookingimager.jpg') }}" alt="Observe" class="cards" />
                <h3>Observe</h3>
                <p>
                  Found a property? See if there are any other groups looking for extra people or start your own.
                </p>
              </div>
              <div class="service-item">
                <img src="{{ url_for('static',filename='images/bananaphoneimager.jpg') }}" alt="Message" class="cards"/>
                <h3>Send</h3>
                <p>
                  Send a message to the group and get the ball rolling!
                </p>
              </div>
            </div>
          </div>
        </div>
      </section>
      <section class="price" style="margin-top:5px">
        <div class="container">
          <div class="price-w1">
            <div class="price-w2">
              <div class="price-text">
                <h2>
                  Want to find your <br />
                  home?
                </h2>
              </div>
              <div class="price-but">
                <a href="{{ url_for('main.property_list') }}"><button><b>Start now!</b></button></a>  
              </div>
            </div>
          </div>
        </div>
      </section>
      <section class="offers">
        <div class="container">
          <div class="offers-text">
            <h2>Why choose us?</h2>
          </div>
          <div class="offers-inner">
            <div class="offers-off">
              <div class="offers-block">
                <img src="{{ url_for('static',filename='images/basic_world.svg') }}" alt="" />
                <div class="offers-off-txt">
                  <h3><b>Local Expertise</b></h3>
                  <p>
                    We are a team of students from the University of Manchester, with firsthand housing experience
                  </p>
                </div>
              </div>
              <div class="offers-block">
                <img src="{{ url_for('static',filename='images/weather_last_quarter.svg') }}" alt="" />
                <div class="offers-off-txt">
                  <h3><b>Safety First</b></h3>
                  <p>
                    All properties and roommates are verified through thorough screening
                  </p>
                </div>
              </div>
              <div class="offers-block">
                <img src="{{ url_for('static',filename='images/music_record.svg') }}" alt="" />
                <div class="offers-off-txt">
                  <h3><b>Student Community</b></h3>
                  <p>
                    We have a growing network of verified students for safe and reliable house-sharing
                  </p>
                </div>
              </div>
            </div>
            <div class="offers-image">
              <img src="{{ url_for('static',filename='images/mcrbeer.jpg') }}" alt="" />
            </div>
          </div>
        </div>
      </section>
      <section class="trust">
        <div class="container">
          <div class="trust-text">
            <h2>Benefits of Our Matching System</h2>
          </div>
          <div class="trust-inner">
            <div class="trust-image">
              <img src="{{ url_for('static',filename='images/houser.jpg') }}" alt="" />
            </div>
            <div class="trust-off">
              <div class="trust-block">
                <div class="trust-off-txt">
                  <h3><b>Better Living Experience</b></h3>
                  <p>
                    Compatible roommates lead to harmonious living environments and lasting friendships
                  </p>
                </div>
                <img src="{{ url_for('static',filename='images/basic_world.svg') }}" alt="" />
              </div>
              <div class="trust-block">
                <div class="trust-off-txt">
                  <h3><b>Cost Efficiency</b></h3>
                  <p>
                    Share expenses effectively with like-minded students who match your budget plans
                  </p>
                </div>
                <img src="{{ url_for('static',filename='images/weather_last_quarter.svg') }}" alt="" />
              </div>
              <div class="trust-block">
                <div class="trust-off-txt">
                  <h3><b>Time Saving</b></h3>
                  <p>
                    The quick matching algorithm finds compatible roommates for you, based on your preferences
                  </p>
                </div>
                <img src="{{ url_for('static',filename='images/music_record.svg') }}" alt="" />
              </div>
            </div>
          </div>
        </div>
      </section>
      <footer class="footer">
        <div class="container">
          <div class="footer-flex">
            <div class="footer-logo">
              <a href="{{ url_for('main.home') }}">
                <img src="{{ url_for('static',filename='images/Logo.png') }}" class="footer-logo" alt="">
              </a>
            </div>
            <div class="footer-pos">
              <p style="font-size:20px;">Our Team:</p>
              <p style="font-size: 15px;">Ismailov Daniel, Marcellus Lynn, Ikenna Darl-Uzu</p>
              <p style="font-size: 15px;">George Turner, Josh Leckenby, Joshua Cooper</p>
            </div>
          </div>
        </div>
      </footer>
    </div>
  </div>
  <script src="{{ url_for('static',filename='js/jquery-3.5.1.min.js') }}"></script>
  <script src="{{ url_for('static',filename='js/java.js') }}"></script>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const accountLink = document.getElementById('account-link');
      const mobileAccountLink = document.getElementById('mobile-account-link');
      
      function updateAuthUI() {
        const isLoggedIn = localStorage.getItem('authToken') !== null;

        
        if (isLoggedIn) {
          accountLink.textContent = 'My Account';
          accountLink.href = "{{ url_for('main.my_account') }}";
          accountLink.classList.add('account-dropdown');
          
          if (!accountLink.querySelector('.dropdown-content')) {
            const dropdownContent = document.createElement('div');
            dropdownContent.className = 'dropdown-content';
            dropdownContent.innerHTML = '<a href="#" id="logout-btn">Log out</a>';
            accountLink.appendChild(dropdownContent);
            
            document.getElementById('logout-btn').addEventListener('click', handleLogout);
          }
          
          if (mobileAccountLink) {
            mobileAccountLink.textContent = 'My Account';
            mobileAccountLink.href = "{{ url_for('main.my_account') }}";
          }
        } else {
          accountLink.textContent = 'Log in';
          accountLink.href = "{{ url_for('main.login') }}";
          accountLink.classList.remove('account-dropdown');
          
          const dropdownContent = accountLink.querySelector('.dropdown-content');
          if (dropdownContent) {
            accountLink.removeChild(dropdownContent);
          }
          
          if (mobileAccountLink) {
            mobileAccountLink.textContent = 'Log in';
            mobileAccountLink.href = "{{ url_for('main.login') }}";
          }
        }
      }
      
      function handleLogout(e) {
        e.preventDefault();
        
        localStorage.removeItem('authToken');
        localStorage.removeItem('username');
        
        updateAuthUI();
        
        fetch("{{ url_for('main.logout') }}", { 
          method: 'POST',
          credentials: 'same-origin'
        })
        .then(response => {
          console.log('Logged out successfully');
        })
        .catch(error => {
          console.error('Logout error:', error);
        });
      }
      
      updateAuthUI();
    });
  </script>
</body>

</html>